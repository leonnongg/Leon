<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Verification</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body{margin:0;font-family:sans-serif;background:linear-gradient(135deg,#b37cff,#ff3b3b);color:#fff;display:flex;align-items:center;justify-content:center;height:100vh}
.card{background:#1c1c2b;width:360px;border-radius:16px;padding:20px;text-align:center}
.hidden{display:none}
input,button{width:100%;padding:12px;border-radius:10px;border:none;margin:8px 0}
button{background:#ff3b3b;color:#fff}
.progress{background:#333;border-radius:10px;overflow:hidden;margin:10px 0}
.bar{height:10px;width:0;background:#4cff4c;transition:.3s}
.offer{background:#2b2b40;border-radius:10px;padding:10px;margin:8px 0}
</style>
</head>
<body>

<div class="card">
  <div id="step1">
    <h2>Enter your Discord username</h2>
    <input id="user" placeholder="username#0000" />
    <button onclick="start()">Verify</button>
  </div>

  <div id="loading" class="hidden">
    <h3>Checkingâ€¦</h3>
    <p>Verifying account</p>
  </div>

  <div id="step2" class="hidden">
    <h3 id="title">Verified âœ”</h3>
    <p id="subtitle">Complete 3 offers to unlock</p>
    <div class="progress"><div id="bar" class="bar"></div></div>
    <div id="offers"></div>
  </div>
</div>

<script>
const clickid = new URLSearchParams(location.search).get("clickid") || "none";
let poll=null;

function start(){
  if(!user.value) return alert("Enter your username");
  step1.classList.add("hidden");
  loading.classList.remove("hidden");
  setTimeout(()=>{
    loading.classList.add("hidden");
    step2.classList.remove("hidden");
    loadOffers();
    poll=setInterval(checkProgress,3000);
  },1200);
}

async function loadOffers(){
  const geo = await fetch("https://ipapi.co/json").then(r=>r.json()).catch(()=>({country_code:"US"}));

  const res = await fetch("https://lockedapp.store/api/v2",{
    headers:{ "Authorization":"Bearer 40260|ycogeb6MnkelTiHaPB0qDNldwdJ02JhtVrSfAoDS7968e3d7" }
  });
  const data = await res.json();

  let offers = (data.offers || []).filter(o =>
    o.model === "cpi" &&
    o.countries &&
    o.countries.split(",").includes(geo.country_code)
  );

  offers.sort((a,b)=>b.payout-a.payout);
  offers = offers.slice(0,5);

  const box = document.getElementById("offers");
  box.innerHTML = "";

  offers.forEach(o=>{
    const join = o.tracking_url.includes("?") ? "&" : "?";
    const d = document.createElement("div");
    d.className="offer";
    d.innerHTML = `
      <b>${o.name}</b><br>
      $${o.payout}<br>
      <button onclick="location.href='${o.tracking_url}${join}subid=${clickid}'">Install</button>
    `;
    box.appendChild(d);
  });
}

async function checkProgress(){
  const r = await fetch(`/api/postback?check=${encodeURIComponent(clickid)}&r=${Math.random()}`);
  if(!r.ok) return;
  const c=parseInt(await r.text())||0;
  bar.style.width=Math.min(c*33,100)+"%";
  if(c>=3){
    clearInterval(poll);
    offers.innerHTML="";
    title.innerText="All done! ðŸŽ‰";
    subtitle.innerText="You are qualified.";
  }
}

const step1=document.getElementById("step1");
const loading=document.getElementById("loading");
const step2=document.getElementById("step2");
const offers=document.getElementById("offers");
const bar=document.getElementById("bar");
const title=document.getElementById("title");
const subtitle=document.getElementById("subtitle");
const user=document.getElementById("user");
</script>

</body>
</html>
